<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            border: 1px solid #ccc; 
            background: #f9f9f9; 
            white-space: pre-wrap;
        }
        button { 
            margin: 5px; 
            padding: 10px 15px; 
            cursor: pointer; 
        }
    </style>
</head>
<body>
    <h1>ğŸ” å‰ç«¯APIè°ƒè¯•é¡µé¢</h1>
    
    <h2>é…ç½®æµ‹è¯•</h2>
    <button onclick="testConfig()">æµ‹è¯•é…ç½®è®¾ç½®</button>
    <button onclick="testAccountInfo()">æµ‹è¯•è´¦æˆ·ä¿¡æ¯</button>
    <div id="configResult" class="result"></div>
    
    <h2>APIæµ‹è¯•</h2>
    <button onclick="testQuote()">æµ‹è¯•è·å–æŠ¥ä»·</button>
    <button onclick="testApprove()">æµ‹è¯•ä»£å¸æˆæƒ</button>
    <div id="apiResult" class="result"></div>
    
    <h2>æ—¥å¿—</h2>
    <div id="logResult" class="result"></div>

    <script>
        // API è°ƒç”¨å‡½æ•°
        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                },
            };

            if (data) {
                options.body = JSON.stringify(data);
            }

            try {
                log(`ğŸš€ APIè°ƒç”¨: ${method} ${endpoint}`);
                if (data) {
                    log(`ğŸ“¤ è¯·æ±‚æ•°æ®: ${JSON.stringify(data, null, 2)}`);
                }
                
                const response = await fetch(endpoint, options);
                const result = await response.json();
                
                log(`ğŸ“¥ å“åº”çŠ¶æ€: ${response.status}`);
                log(`ğŸ“¥ å“åº”æ•°æ®: ${JSON.stringify(result, null, 2)}`);
                
                return result;
            } catch (error) {
                log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`);
                return {
                    success: false,
                    message: error.message
                };
            }
        }

        function log(message) {
            const logDiv = document.getElementById('logResult');
            logDiv.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function showResult(elementId, result) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(result, null, 2);
        }

        // æµ‹è¯•é…ç½®è®¾ç½®
        async function testConfig() {
            log('ğŸ”§ å¼€å§‹æµ‹è¯•é…ç½®è®¾ç½®...');
            
            const configData = {
                okxApiKey: '3e9368cb-fbc8-4619-99d5-be6ae9d4a587',
                okxSecretKey: 'A9A90D44BAB95D173D3B1E6D7A0E5B8A',
                okxPassphrase: 'Aa5201314@',
                okxProjectId: '6fce5249fd13eeceab040c742db888d0',
                rpcUrl: 'https://bsc-dataseed.binance.org/',
                chainId: '56',
                walletAddress: '0xdc7396cc6b301a77562737c7f37f02d1f02a0ae3',
                privateKey: '5db1ed7baf98ae8d5b76e65411ec58ba48a5065fd3fb3d5f3ddfa8b13e7329ba'
            };

            const result = await apiCall('/api/config', 'POST', configData);
            showResult('configResult', result);
        }

        // æµ‹è¯•è´¦æˆ·ä¿¡æ¯
        async function testAccountInfo() {
            log('ğŸ“Š å¼€å§‹æµ‹è¯•è´¦æˆ·ä¿¡æ¯...');
            const result = await apiCall('/api/account');
            showResult('configResult', result);
        }

        // æµ‹è¯•è·å–æŠ¥ä»·
        async function testQuote() {
            try {
                const quoteData = {
                    fromTokenAddress: '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE', // ETH
                    toTokenAddress: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', // USDC
                    amount: '1000000000000000000', // 1 ETH
                    slippage: '0.5',
                    chainIndex: '1', // ä»¥å¤ªåŠé“¾ç´¢å¼•
                    chainId: '1',    // ä»¥å¤ªåŠé“¾IDï¼ˆå…¼å®¹ï¼‰
                    userWalletAddress: '0x742d35cc6635C0532925a3b8F2F3126dfC6C6F1b' // æ¢å¤å¿…éœ€çš„å‚æ•°
                };
                
                showLog(`å‘é€æŠ¥ä»·è¯·æ±‚: ${JSON.stringify(quoteData, null, 2)}`);
                const result = await apiCall('/api/quote', 'POST', quoteData);
                showResult('quoteResult', result);
            } catch (error) {
                console.error('æŠ¥ä»·æµ‹è¯•å¤±è´¥:', error);
                showResult('quoteResult', { success: false, error: error.message });
            }
        }

        // æµ‹è¯•ä»£å¸æˆæƒ
        async function testApprove() {
            log('ğŸ” å¼€å§‹æµ‹è¯•ä»£å¸æˆæƒ...');
            
            const approveData = {
                tokenAddress: '0x55d398326f99059fF775485246999027B3197955', // USDT
                amount: '1000000000000000000' // 1 USDT
            };

            const result = await apiCall('/api/approve', 'POST', approveData);
            showResult('apiResult', result);
        }

        log('âœ… è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
    </script>
</body>
</html> 